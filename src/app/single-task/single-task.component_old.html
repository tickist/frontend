<div class="task" fxLayout="row" fxLayoutAlign="start none">
    <div (click)="toggleDone()" [ngClass]="task.priority" fxFlex="60px" class="done">
        <i class="fa"
           [ngClass]="{'fa-check-square-o': task.status == 1, 'fa-square-o': task.status == 0, 'fa-pause': task.status == 2 }">
        </i>

    </div>
    <div fxLayout="column" fxFlex>
        <div id="first-row" fxLayout="row">
            <task-name [task]=task></task-name>
            <span fxFlex></span>
            <div class="right-menu">
                <button mat-button class="mat-icon-button small-icon" [routerLink]="['/home/task', task.id]">
                    <i class="fa fa-edit"></i>
                </button>
                <button mat-button mat-tooltip="Do it today" aria-label="Pin task"
                        class="hover_button mat-icon-button small-icon"
                        (click)="togglePin()"
                        [ngClass]="{pinned: task.pinned == true, unpinned: task.pinned == false}">
                    <i class="fa fa-thumb-tack"></i>
                </button>
                <button mat-button class="mat-icon-button small-icon" [matMenuTriggerFor]="menu">
                    <i class="fa fa-ellipsis-v"></i>
                    <mat-menu #menu="matMenu" class="fast-menu">

                         <div fxLayout="column" fxLayoutAlign="space-between stretch"  class="fast-menu">
                             <span fxFlex="100">Priority</span>
                             <div>
                                <mat-button-toggle-group [value]="task.priority" (change)="changePriority($event)">
                                    <mat-button-toggle [value]="'A'">A</mat-button-toggle>
                                    <mat-button-toggle [value]="'B'">B</mat-button-toggle>
                                    <mat-button-toggle [value]="'C'">C</mat-button-toggle>
                                </mat-button-toggle-group>
                             </div>
                         </div>
                         <div fxLayout="column" class="fast-menu">
                             <span fxFlex="100">Change date</span>
                             <div fxFlex="100" fxLayout="row" fxLayoutAlign="space-around stretch" class="change-data-icon-set">
                                <span><i matTooltip="today" class="fa fa-desktop" (click)="changeDate('today')"></i></span>
                                <span><i matTooltip="next day" class="fa fa-sun-o"  (click)="changeDate('next_day')"></i></span>
                                <span><i matTooltip="next week" class="fa fa-reply rotate-180" (click)="changeDate('next_week')"></i></span>
                                <span><i matTooltip="next month" class="fa fa-reply-all rotate-180" (click)="changeDate('next_month')"></i></span>
                             </div>
                         </div>
                        <div id="delete-button" fxLayout="column" class="fast-menu">
                            <button mat-button (click)="deleteTask()"><span>delete</span></button>
                        </div>


                    </mat-menu>


                </button>
            </div>
        </div>
        <div fxLayout="row" fxLayoutAlign="center center">
            <span class="task-list-icon" [matTooltip]="task.taskProject.name" (click)="changeShowing('isTaskProject')">
                <i class="fa fa-list " [ngStyle]="{'color': task.taskProject.color}"></i>
            </span>

            <button mat-button class="mat-icon-button small-icon" aria-label="Task description"
                    [ngClass]="{'disappear': !task.description}"
                    (click)="changeShowing('isDescription')">
                <i class="fa fa-comment-o"></i>
            </button>
            <button mat-button class="mat-icon-button small-icon" aria-label="Tags"
                    [ngClass]="{'disappear': task.tags.length === 0}"
                    (click)="changeShowing('isTags')">
                <i class="fa fa-tags"></i>
            </button>
            <button mat-button class="mat-icon-button small-icon" aria-label="Task repeat options"
                    (click)="changeShowing('isRepeat')"
                    [ngClass]="{'disappear': task.repeat == 0}">
                <i class="fa fa-repeat"></i>
            </button>
            <button mat-button class="mat-icon-button small-icon user-avatar" *ngIf="task.menuShowing['sharedList']"
                    (click)="changeShowing('isAssignedTo')" [matTooltip]="task.owner.username">
                <img [src]="staticUrl + task.owner.avatarUrl | avatarsize: '16x16'">
            </button>
            <span fxHide.xs (click)="changeShowing('isSteps')" fxFlex="20"  [ngClass]="{'disappear': task.steps.length === 0}">
                <mat-progress-bar mode="determinate" class="progress-bar"  [value]="task.percent"></mat-progress-bar>
            </span>
             <button fxShow.xs fxHide.gt-xs mat-button class="mat-icon-button small-icon" (click)="changeShowing('isSteps')">
               <i class="fa fa-tasks" aria-hidden="true"></i>
            </button>
            <span fxFlex></span>
            <span class="finish-date-icon" *ngIf="task.finishDate" (click)="changeShowing('isFinishDate')">
                <i class="fa"
                   [ngClass]="{'fa-dot-circle-o': task.typeFinishDate == '1', 'fa-arrow-right': task.typeFinishDate == '0'}"></i>
            </span>
            <span (click)="changeShowing('isFinishDate')" class="finish-date-date" *ngIf="task.finishDate">{{ task.finishDate.format(dateFormat) }}</span>


        </div>
    </div>

</div>

<div fxLayout="column" fxLayoutAlign="start stretch">
    <div class="task-description" *ngIf="task.menuShowing['isDescription']" fxFlexOffset="60px" [innerHTML]="task.richDescription">

    </div>


    <div *ngIf="task.menuShowing['isSteps']" class="steps" fxFlexOffset="60px">

        <div class="step" *ngFor="let step of task.steps" fxLayout="row" fxLayoutAlign="start stretch" (click)="toggleDoneStep(step)"
                      [ngClass]="{'taskstep-done': step.status == 1, 'taskstep-undone': step.status == 0}">
            <i class="fa fa-check-square-o"></i>
            <i class="fa fa-square-o"></i>
            <span class="step-name" fxFlex>{{ step.name }}</span>
        </div>

    </div>

    <div *ngIf="task.menuShowing['isTags']" class="task-tags" fxFlexOffset="60px">
        <mat-chip-list class="mat-chip-list-stacked">
            <mat-chip *ngFor="let tag of task.tags" >
                <span>{{ tag.name }}</span><span fxFlex></span><i matTooltip="Remove tag" (click)="removeTag(tag)" class="fa fa-times"></i>
            </mat-chip>
        </mat-chip-list>
    </div>

    <div id="repeat-options" *ngIf="task.menuShowing['isRepeat']" fxFlexOffset="60px">
         <app-edit-repeating-option [task]="task"></app-edit-repeating-option>

    </div>
    <div *ngIf="task.menuShowing['isTaskProject']">
        <div id="change-project-task" fxFlexOffset="60px">
            <mat-select placeholder="Project:" [(ngModel)]="task.taskProject.id" (change)="changeProject($event)">
                <mat-option *ngFor="let project of projects"
                           [value]="project.id"> {{ project.name }} </mat-option>
            </mat-select>
        </div>
    </div>

    <div *ngIf="task.menuShowing['isAssignedTo']">
        <div  id="change-assigned-to" fxFlexOffset="60px">
            <mat-select placeholder="Assigned to:" [(ngModel)]="task.owner.id" (change)="changeAssignedTo($event)">
                <mat-option *ngFor="let user of task.taskProject.shareWith"
                           [value]="user.id"> {{ user.username }} </mat-option>
            </mat-select>
        </div>
    </div>

    <div id="finish-date-options" *ngIf="task.menuShowing['isFinishDate']" fxFlexOffset="60px">
        <app-date-options [task]="task"></app-date-options>

    </div>


</div>

